@model IEnumerable<Assignment.Models.DomainClass.Product>
@using Assignment.Models.DomainClass;
@{
	ViewData["Title"] = "Index";
}

<h1>Danh sách sản phẩm</h1>

<p>
	<a asp-action="Create">Thêm mới</a>
</p>

<table class="table " ">
	<thead>
		<tr>
			<th>
@Html.DisplayNameFor(model => model.ImageMainUrl)
			</th>
			<th>
@Html.DisplayNameFor(model => model.Name)
			</th>
			<th>
@Html.DisplayNameFor(model => model.Description)
			</th>
			<th>
@Html.DisplayNameFor(model => model.Price)
			</th>
			<th>
@Html.DisplayNameFor(model => model.Brand)
			</th>
			<th>
				Màu sắc
			</th>
			<th>
				Kích thước
			</th>
			<th>
@Html.DisplayNameFor(model => model.Status)
			</th>
			<th></th>
		</tr>
	</thead>
	<tbody class=">
	@foreach (var item in Model)
	{
			<tr class="align-middle">
				<td>
					<img style="width:90px" src="@item.ImageMainUrl" alt="Product Image" />
				</td>
				<td>
				@Html.DisplayFor(modelItem => item.Name)
				</td>
			@{
				string truncatedDescription = "";
				if (item.Description.Length >= 20)
				{
					truncatedDescription = item.Description.Substring(0, 20) + "...";
				}
				else
				{
					truncatedDescription = item.Description;
				}
			}
				<td>
				@truncatedDescription
				</td>
				<td>
				@Html.DisplayFor(modelItem => item.Price)
				</td>

				<td>
				@Html.DisplayFor(modelItem => item.Brand.Name)
				</td>
			@{
				List<ProductVariant> lstColor = item.ProductVariants.ToList().GroupBy(p => p.ColorID)
				.Select(g => g.First())
				.ToList();
				List<ProductVariant> lstSize = item.ProductVariants.ToList().GroupBy(p => p.SizeID)
				.Select(g => g.First())
				.ToList();

			}
				<td>
				@foreach (var variant in lstColor)
				{
						<span>@(variant.Color == null ? "" : variant.Color.Name)</span>
						<br />
				}
				</td>
				<td>
				@foreach (var variant in lstSize)
				{
						<span>@(variant.Size == null ? "" : variant.Size.Name)</span>
						<br />
				}
				</td>
				<td>
				@((item.Status == 1) ? "Đang bán" : "Ngừng bán")
				</td>
				<td>
					<a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
					<a asp-action="Details" asp-route-id="@item.Id">Details</a> |
					<a asp-controller="ProductVariants" asp-action="Index" asp-route-id="@item.Id">Màu sắc,Size</a>

				</td>
			</tr>
	}
	</tbody>
</table>
